<?php

//--------------------------------------------------------------------------------------------------
/**
 * @brief Test whether HTTP code is valid
 *
 * HTTP codes 200 and 302 are OK.
 *
 * For JSTOR we also accept 403
 *
 * @param HTTP code
 *
 * @result True if HTTP code is valid
 */
function HttpCodeValid($http_code)
{
	if ( ($http_code == '200') || ($http_code == '302') || ($http_code == '403'))
	{
		return true;
	}
	else{
		return false;
	}
}


//--------------------------------------------------------------------------------------------------
/**
 * @brief GET a resource
 *
 * Make the HTTP GET call to retrieve the record pointed to by the URL. 
 *
 * @param url URL of resource
 *
 * @result Contents of resource
 */
function get($url, $userAgent = '', $timeout = 0)
{
	$data = '';
	
	$ch = curl_init(); 
	curl_setopt ($ch, CURLOPT_URL, $url); 
	curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1); 
	curl_setopt ($ch, CURLOPT_FOLLOWLOCATION,	1); 
	//curl_setopt ($ch, CURLOPT_HEADER,		  1);  

	//curl_setopt ($ch, CURLOPT_COOKIEJAR, 'cookie.txt');
	
	if ($userAgent != '')
	{
		curl_setopt($ch, CURLOPT_USERAGENT, $userAgent);
	}	
	
	if ($timeout != 0)
	{
		curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);
	}
			
	$curl_result = curl_exec ($ch); 
	
	if (curl_errno ($ch) != 0 )
	{
		echo "CURL error: ", curl_errno ($ch), " ", curl_error($ch);
	}
	else
	{
		$info = curl_getinfo($ch);
		
		//$header = substr($curl_result, 0, $info['header_size']);
		//echo $header;
		
		
		$http_code = $info['http_code'];
		
		//echo "<p><b>HTTP code=$http_code</b></p>";
		
		if (HttpCodeValid ($http_code))
		{
			$data = $curl_result;
		}
	}
	return $data;
}

$base_dir = 'rdf';
$base_dir = 'rdf-extra';

$ids=array(
/*1030,
1035050,
1035495,
1041473,
1064657,
1084604,
1160569,
1165041,
1165354,
1165370,
1165378,
1171406,
1221516,
1226179,
1235870,
1265311,
13174,
1320046,
1325733,
1336011,
1379672,
1379673,
1380214,
1507382,
1529203,
1529204,
1529205,
1548422,
1594179,
1648763,
1657953,
1700179,
1700180,
1700240,
1729028,
173674,
1831151,
1864948,
187345,
1883196,
1945573,
1949929,
2166644,
22205,
2260399,
2266176,
2268261,
2269861,
2304552,
2306228,
2307644,
2308949,
2311250,
2312551,
2313753,
2314763,
2315868,
2317256,
2348174,
2350405,
2352091,
2353784,
2355542,
2357135,
2358742,
2361788,
2363356,
2365160,
2409695,
2418986,
2424242,
2424243,
2424245,
2424247,
2424250,
2424251,
2424253,
2424254,
2424256,
2424257,
2424258,
2424260,
2424261,
2424263,
2424264,
2424265,
2424266,
2424269,
2424270,
2424272,
2424274,
2424275,
2457476,
2467426,
247877,
2488035,
2500064,
2502660,
2543312,
2544918,
2546187,
2547239,
2547995,
2548579,
2549234,
2550026,
2550598,
2551091,
2551612,
2552892,
2553585,
2554316,
2554942,
2555607,
2556324,
2556993,
2561588,
2569407,
2588371,
2590928,
2591782,
2592450,
2593244,
2595126,
2595715,
2595728,
2596179,
2596709,
2597181,
2597798,
2598189,
2603855,
2603856,
2603857,
2603858,
2603859,
2603860,
2603861,
2603862,
2603863,
2606372,
2606373,
2606374,
2606375,
2606376,
2606377,
2606378,
2606379,
2606380,
2606381,
2606382,
2606383,
2606384,
2606385,
2606386,
2606387,
2606388,
2606389,
2606390,
2606391,
2606392,
2606393,
2606394,
2606395,
2606396,
2606397,
2606398,
2606399,
2606400,
2606401,
2606402,
2606403,
2606404,
2606405,
2606406,
2606407,
2606408,
2606409,
2606410,
2606411,
2606412,
2606413,
2606414,
2606415,
2606416,
2606417,
2606418,
2606419,
2606420,
2606421,
2606422,
2606423,
2606424,
2606425,
2606426,
2606427,
2606428,
2606429,
2606430,
2606431,
2606432,
2606433,
2606434,
2606435,
2606436,
2606437,
2606438,
2606439,
2606440,
2606441,
2606442,
2606443,
2606444,
2606445,
2606446,
2606447,
2606448,
2606449,
2606450,
2606451,
2606452,
2606453,
2606454,
2606455,
2606456,
2606457,
2606458,
2606459,
2606460,
2606461,
2606462,
2606463,
2606464,
2606465,
2606466,
2606467,
2606468,
2606469,
2606470,
2606471,
2606472,
2606473,
2606474,
2606475,
2606476,
2606477,
2606479,
2606480,
2606481,
2606482,
2606483,
2606484,
2606485,
2606486,
2606487,
2606488,
2606489,
2606490,
2606491,
2606492,
2606493,
2606494,
2606495,
2606496,
2606497,
2606498,
2606499,
2606500,
2606501,
2606502,
2606503,
2606504,
2606505,
2606506,
2606507,
2606508,
2606509,
2606510,
2606511,
2606515,
2606517,
2606518,
2606524,
2606526,
2606528,
2606529,
2606530,
2606531,
2606534,
2606535,
2606536,
2606537,
2606538,
2606539,
2606540,
2606541,
2606542,
2606543,
2606544,
2606545,
2606546,
2606547,
2606548,
2606549,
2606550,
2606551,
2606552,
2606553,
2606554,
2606555,
2606556,
2606557,
2606558,
2606559,
2606560,
2606561,
2606562,
2606563,
2606564,
2606565,
2606566,
2606567,
2606568,
2606569,
2606570,
2606571,
2606572,
2606573,
2606574,
2606575,
2606576,
2606577,
2606578,
2606579,
2606580,
2606581,
2606582,
2606583,
2606584,
2606585,
2606586,
2606587,
2606588,
2606589,
2606590,
2606591,
2606592,
2606593,
2606594,
2606595,
2606596,
2606597,
2606598,
2606599,
2606600,
2606601,
2606602,
2606603,
2606604,
2606605,
2606606,
2606607,
2606608,
2606609,
2606610,
2606611,
2606612,
2606613,
2606614,
2606615,
2606616,
2606617,
2606618,
2606619,
2606620,
2606621,
2606622,
2606623,
2606624,
2606625,
2606626,
2606627,
2606628,
2606629,
2606630,
2606631,
2606632,
2606633,
2606634,
2606635,
2606636,
2606637,
2606638,
2606639,
2606640,
2606641,
2606642,
2606643,
2606644,
2606645,
2606646,
2606647,
2606648,
2606649,
2606650,
2606651,
2606652,
2606653,
2606654,
2606655,
2606656,
2606657,
2606658,
2606659,
2606660,
2606661,
2606662,
2606663,
2606664,
2606665,
2606666,
2606667,
2606668,
2606669,
2606670,
2606671,
2606672,
2606673,
2606674,
2606675,
2606676,
2606677,
2606678,
2606679,
2606680,
2606681,
2606682,
2606683,
2606684,
2606685,
2606686,
2637782,
2637783,
2637784,
2637785,
2637786,
2637787,
2637788,
2637789,
2637790,
2637791,
2676128,
2691388,
2749819,
2756219,
278052,
2791892,
282063,
283236,
2858584,
2863492,
2929680,
2929824,
2930072,
2930073,
2930074,
2930705,
2930706,
2930707,
2930708,
2930709,
2930791,
2934445,
2934446,
2934447,
2934448,
2957498,
2974176,
2974904,
2991002,
3011328,
3093868,
3172465,
3200993,
3210032,
3309922,
3336979,
3336980,
3336981,
3336982,
3351902,
3393887,
3395572,
3399879,
3402411,
3411453,
3427191,
3476904,
3476953,
3476955,
3476964,
3478529,
3479789,
3481075,
3482055,
3483015,
3485421,
3486790,
3487448,
3489365,
3489973,
3490703,
3492375,
3496663,
3502691,
3605125,
3605592,
3606133,
3607422,
3608069,
3608646,
3609706,
3610212,
3610819,
3611520,
3612177,
3613906,
3615225,
3620966,
3627890,
3627923,
3627924,
3627925,
3627926,
3627927,
3627928,
3627929,
3647636,
3651199,
3651732,
3652184,
3652547,
3652888,
3653370,
3653704,
3654371,
3655035,
3655786,
3656139,
3656457,
3657041,
3657322,
3657646,
3658365,
3658706,
3659063,
3660173,
3660557,
3660954,
3661308,
3661620,
3661952,
3662359,
3665017,
3718396,
3721057,
3721922,
3722550,
3722960,
3723321,
3723665,
3723969,
3724326,
3724582,
3724884,
3725178,
3725467,
3725741,
3725995,
3726262,
3726536,
3726774,
3727053,
3727305,
3727811,
3728066,
3728569,
3728819,
3729076,
3729325,
3729567,
3729821,
3730080,
3730307,
3730573,
3730908,
3731227,
3731531,
3731785,
3732455,
3732918,
3733517,
3734702,
3734703,
3736797,
3740093,
3754184,
3755490,
3756232,
3756673,
3757109,
3757479,
3757901,
3758311,
3758669,
3758960,
3759244,
3759480,
3759768,
3760081,
3760435,
3760784,
3761106,
3761475,
3761858,
3762189,
3762838,
3763076,
3763398,
3763726,
3763983,
3764207,
3764489,
3764761,
3765023,
3765345,
3767060,
3767985,
3769946,
3775416,
405017,
41484,
42506,
4315001,
4315002,
4315003,
4315004,
4315005,
4315006,
4315007,
4315008,
4315009,
4315010,
4315011,
4315012,
4315013,
4315014,
4315015,
4315016,
4315017,
4315018,
4315019,
4315020,
4315021,
4315022,
4315023,
4315024,
4315025,
4315026,
4315027,
4315028,
4315029,
4315030,
4315031,
4315032,
4315033,
4315034,
4315035,
4315036,
4315037,
4315038,
4315039,
4315040,
4315041,
4315042,
4315043,
4315044,
4315045,
4315046,
4315047,
4315048,
4315049,
4315050,
4315051,
4315052,
4315053,
4315054,
4315055,
4315056,
4315057,
4315058,
4315059,
4315060,
4315061,
4315062,
4315063,
4315064,
4315065,
4315066,
4315067,
4315068,
4315069,
4315070,
4315071,
4315072,
4315073,
4315074,
4315075,
4315076,
4315077,
4315078,
4315079,
4315080,
4315081,
4315082,
4315083,
4315084,
4315085,
4315086,
4315087,
4315088,
4315089,
4315090,
4315091,
4315092,
4315093,
4315094,
4315095,
4315096,
4315097,
4315098,
4315099,
4315100,
4315101,
4315102,
4315103,
4315104,
4315105,
4315106,
4315107,
4315108,
4315109,
4315110,
4315111,
4315112,
4315113,
4315114,
4315115,
4315116,
4315117,
4315118,
4315119,
4315120,
4315121,
4315122,
4315123,
4315124,
4315125,
4315126,
4315127,
4315128,
4315129,
4315130,
4315131,
4315132,
4315133,
4315134,
4315135,
4315136,
4315137,
4315138,
4315139,
4315140,
4315141,
4315142,
4315143,
4315144,
4315145,
4315146,
4315147,
4315148,
4315149,
4315150,
4315151,
4315152,
4315153,
4315154,
4315155,
4315156,
4315157,
4315158,
4315159,
4315160,
4315161,
4315162,
4315163,
4315164,
4315165,
4315166,
4315167,
4315168,
4315169,
4315170,
4315171,
4315172,
4315173,
4315174,
4315175,
4315176,
4315177,
4315178,
4315179,
4315180,
4315181,
4315182,
4315183,
4315184,
4315185,
4315186,
4315187,
4315188,
4315189,
4315190,
4315191,
4315192,
4315193,
4315194,
4315195,
4315196,
4315197,
4315198,
4315199,
4315200,
4315201,
4315202,
4315203,
4315204,
4315205,
4315206,
4315207,
4315208,
4315209,
4315210,
4315211,
4315212,
4315213,
4315214,
4315215,
4315216,
4315217,
4315218,
4315219,
4315220,
4315221,
4315222,
4315223,
4315224,
4315225,
4315226,
4315227,
4315228,
4315229,
4315230,
4315231,
4315232,
4315233,
4315234,
4315235,
4315236,
4315237,
4315238,
4315239,
4315240,
4315241,
4315242,
4315243,
4315244,
4315245,
4315246,
4315247,
4315248,
4315249,
4315250,
4315251,
4315252,
4315253,
4315254,
4315255,
4315256,
4315257,
4315258,
4315259,
4315260,
4315261,
4315262,
4315263,
4315264,
4315265,
4315266,
4315267,
4315268,
4315269,
4315270,
4315271,
4315272,
4315273,
4315274,
4315275,
4315276,
4315277,
4315278,
4315279,
4315280,
4315281,
4315282,
4315283,
4315284,
4315285,
4315286,
4315287,
4315288,
4315289,
4315290,
4315291,
4315292,
4315293,
4315294,
4315295,
4315296,
4315297,
4315298,
4315299,
4315300,
4315301,
4315302,
4315303,
4315304,
4315305,
4315306,
4315307,
4315308,
4315309,
4315310,
4315311,
4315312,
4315313,
4315314,
4315315,
4315316,
4315317,
4315318,
4315319,
4315320,
4315321,
4315322,
4315323,
4315324,
4315325,
4315326,
4315327,
4315328,
4315329,
4315330,
4315331,
4315332,
4315333,
4315334,
4315335,
4315336,
4315337,
4315338,
4315339,
4315340,
4315341,
4315342,
4315343,
4315344,
4315345,
4315346,
4315347,
4315348,
4315349,
4315350,
4315351,
4315352,
4315353,
4315354,
4315355,
4315356,
4315357,
4315358,
4315359,
4315360,
4315361,
4315362,
4315363,
4315364,
4315365,
4315366,
4315367,
4315368,
4315369,
4315370,
4315371,
4315372,
4315373,
4315374,
4315375,
4315376,
4315377,
4315378,
4315379,
4315380,
4315381,
4315382,
4315383,
4321137,
4326619,
4329490,
4330543,
4331211,
4331528,
4331796,
4332069,
4332350,
4332575,
4332830,
4333152,
4333723,
4334054,
4334696,
4335082,
4335449,
4335777,
4336125,
// 4336293, // doesn't exist
4336471,
4336774,
4337302,
4337585,
4337875,
4338236,
4338640,
4339067,
4339435,
// 4339557, // doesn't exist
4339876,
4341064,
4342381,
4356533,
4359812,
4363098,
4363692,
4364139,
4364359,
4364612,
4364707,
4365110,
4365367,
4365620,
4366125,
4366374,
4366623,
4366863,
4367358,
4367632,
4367865,
4368139,
4368395,
4368645,
4368920,
4369200,
4369494,
4369795,
4370049,
4371050,
4371407,
4371818,
4372437,
4373291,
4375945,
4430563,
4431338,
4431868,
4432279,
4432617,
4432925,
4433268,
4433666,
4434057,
4434779,
4435494,
4435829,
4436875,
4437167,
4438069,
4438428,
4438820,
4439177,
4439842,
4440516,
4441689,
4442046,
4442500,
4443037,
4443645,
4444263,
4445111,
4446582,*/
4461366,
4466177,
4466178,
4466179,
4466180,
4466181,
4466182,
4466217,
4469057,
4469058,
4469059,
4473147,
4473156,
4473980,
4473983,
4473984,
4474014,
4474056,
4474057,
4474058,
4477101,
4478615,
4478616,
4478669,
4478670,
4478859,
4479021,
4479023,
4479026,
4479027,
4479032,
4479033,
4479034,
4479035,
4479036,
4479037,
4479038,
4479039,
4479040,
4479041,
4479042,
4479043,
4479044,
4479045,
4479046,
4479047,
4479048,
4479049,
4479050,
4479051,
4479052,
4479053,
4479054,
4479055,
4479056,
4479057,
4479058,
4479059,
4479060,
4479061,
4479062,
4479063,
4479064,
4479065,
4479066,
4479067,
4479068,
4480195,
4481204,
4481898,
4483837,
4484093,
4484330,
4484820,
4485376,
4486608,
4487223,
4487906,
4488436,
4488897,
46440,
48035,
49789,
498886,
498889,
498898,
498956,
499217,
499242,
5862,
51544,
53451,
55246,
57051,
575182,
58731,
60100,
607844,
61156,
62238,
63913,
65860,
672070,
68266,
681273,
70892,
720306,
830971,
831203,
831235,
831250,
831256,
831281,
831286,
831310,
831341,
831346,
831349,
831355,
831362,
831368,
831370,
831375,
831386,
831394,
831408,
831415,
831446,
831450,
831451,
831476,
831479,
831491,
831497,
831501,
831513,
831519,
831534,
831535,
831548,
831551,
831654,
831661,
831672,
831673,
831715,
831747,
845230,
847934,
894224,
93841,
937648,
948911,
948912,
948914,
948915,
948916,
948917,
948918,
948919,
948920,
948921,
948922,
948923,
948924,
948925,
948926,
948927,
948928,
948929,
948930,
948931,
948932,
948933,
948934,
948935,
948936,
948937,
948938,
948939,
948940,
948941,
948942,
948943,
948944,
948946,
948947,
948948,
948949,
948950,
948951,
948952,
948953,
948954,
948955,
948956,
948957,
948958,
948959,
948960,
948961,
948962,
948963,
948964,
948965,
948966,
948967,
948968,
948969,
948970,
948971,
948972,
948973,
948974,
948975,
948976,
948977,
948978,
948979,
948980,
948981,
948982,
948983,
948984,
948985,
948986,
948989,
948990,
948991,
948993,
948994,
948997,
948998,
948999,
949000,
949001,
949003,
949005,
949007,
949008,
949010,
949011,
949013,
949014,
949015,
949016,
949017,
949019,
949020,
949021,
949022,
949023,
949024,
949025,
949026,
949027,
949028,
949029,
949030,
949031,
949032,
949033,
949035,
949036,
949037,
949038,
949039,
949040,
949041,
949042,
949044,
949045,
949046,
949047,
949048,
949049,
949050,
949052,
949053,
949054,
949055,
949056,
949057,
949058,
949060,
949062,
949063,
949064,
949065,
949066,
949067,
949068,
949069,
949070,
949071,
949072,
949073,
949074,
949075,
949076,
949077,
949078,
949079,
949080,
949081,
949082,
949083,
949084,
949085,
949086,
949088,
949089,
951122,
951227,
956799,
956800,
956801,
956802,
956803,
956804,
956805,
956806,
956807,
956808,
956809,
956810,
956811,
956812,
956813,
956814,
956815,
956816,
956817,
956818,
956819,
956820,
956821,
956822,
956823,
956824,
956825,
956826,
956827,
956828,
956829,
956830,
956831,
956832,
956833,
956834,
956835,
956836,
956837,
956838,
956839,
956840,
956841,
956842,
956843,
956844,
956845,
956847,
956848,
956849,
956850,
956851,
956852,
956853,
956854,
956855,
956856,
956857,
956858,
956859,
956860,
956861,
956862,
956863,
956864,
956865,
956866,
956867,
956868,
958962,
958963,
958964,
958965,
958966,
958967,
958968,
958970,
958971,
958972,
958973,
958974,
96849,
986734,
990535
);


$start = 4501000;
$stop  = 4505999;

$count = 0;

//foreach ($ids as $id)
for ($id = $start; $id <= $stop; $id++)
{
	echo $id . "\n";
	
	$lsid = 'urn:lsid:organismnames.com:name:' . $id;
	
	$url = 'http://organismnames.com:80/authority/metadata/?lsid=' . $lsid;
	
	$xml = get($url, 'Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Mobile/7B405');
	
	//echo $xml;
	
	if (substr($xml, 0, 5) != '<?xml')
	{
		echo "Not XML\n";
		//exit();
	}	
	else
	{			
		$dir = floor($id / 1000);
		
		$dir = dirname(__FILE__) . "/$base_dir/" . $dir;
		if (!file_exists($dir))
		{
			$oldumask = umask(0); 
			mkdir($dir, 0777);
			umask($oldumask);
		}
		
		$f = $dir . '/' . $id . '.xml';
		$file = fopen($f, "w");
		fwrite($file, $xml);
		fclose($file);
	}
	
	if (($count++ % 10) == 0)
	{
		$rand = rand(2000000, 6000000);
    	echo '...sleeping for ' . round(($rand / 1000000),2) . ' seconds' . "\n";
    	usleep($rand);
    }
}



?>